function getCurrentPage(){var page=$(":mobile-pagecontainer").pagecontainer("getActivePage");return $(page).attr("id")}(function(){function baseIndexOf(array,value,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0;++index<length;)if(array[index]===value)return index;return-1}function compareAscending(a,b){for(var ac=a.criteria,bc=b.criteria,index=-1,length=ac.length;++index<length;){var value=ac[index],other=bc[index];if(value!==other){if(value>other||"undefined"==typeof value)return 1;if(other>value||"undefined"==typeof other)return-1}}return a.index-b.index}function escapeStringChar(match){return"\\"+stringEscapes[match]}function slice(array,start,end){start||(start=0),"undefined"==typeof end&&(end=array?array.length:0);for(var index=-1,length=end-start||0,result=Array(0>length?0:length);++index<length;)result[index]=array[start+index];return result}function lodash(value){return value instanceof lodash?value:new lodashWrapper(value)}function lodashWrapper(value,chainAll){this.__chain__=!!chainAll,this.__wrapped__=value}function baseBind(bindData){function bound(){if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if(this instanceof bound){var thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments);return isObject(result)?result:thisBinding}return func.apply(thisArg,args||arguments)}var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];return bound}function baseCreate(prototype){return isObject(prototype)?nativeCreate(prototype):{}}function baseCreateCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if("undefined"==typeof thisArg||!("prototype"in func))return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 2:return function(a,b){return func.call(thisArg,a,b)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)}}return bind(func,thisArg)}function baseCreateWrapper(bindData){function bound(){var thisBinding=isBind?thisArg:this;if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if((partialRightArgs||isCurry)&&(args||(args=slice(arguments)),partialRightArgs&&push.apply(args,partialRightArgs),isCurry&&args.length<arity))return bitmask|=16,baseCreateWrapper([func,isCurryBound?bitmask:-4&bitmask,args,null,thisArg,arity]);if(args||(args=arguments),isBindKey&&(func=thisBinding[key]),this instanceof bound){thisBinding=baseCreate(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding}return func.apply(thisBinding,args)}var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5],isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isCurryBound=8&bitmask,key=func;return bound}function baseDifference(array,values){for(var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];++index<length;){var value=array[index];indexOf(values,value)<0&&result.push(value)}return result}function baseFlatten(array,isShallow,isStrict,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0,result=[];++index<length;){var value=array[index];if(value&&"object"==typeof value&&"number"==typeof value.length&&(isArray(value)||isArguments(value))){isShallow||(value=baseFlatten(value,isShallow,isStrict));var valIndex=-1,valLength=value.length,resIndex=result.length;for(result.length+=valLength;++valIndex<valLength;)result[resIndex++]=value[valIndex]}else isStrict||result.push(value)}return result}function baseIsEqual(a,b,stackA,stackB){if(a===b)return 0!==a||1/a==1/b;var type=typeof a,otherType=typeof b;if(!(a!==a||a&&objectTypes[type]||b&&objectTypes[otherType]))return!1;if(null==a||null==b)return a===b;var className=toString.call(a),otherClass=toString.call(b);if(className!=otherClass)return!1;switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case regexpClass:case stringClass:return a==String(b)}var isArr=className==arrayClass;if(!isArr){var aWrapped=a instanceof lodash,bWrapped=b instanceof lodash;if(aWrapped||bWrapped)return baseIsEqual(aWrapped?a.__wrapped__:a,bWrapped?b.__wrapped__:b,stackA,stackB);if(className!=objectClass)return!1;var ctorA=a.constructor,ctorB=b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)&&"constructor"in a&&"constructor"in b)return!1}stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==a)return stackB[length]==b;var result=!0,size=0;if(stackA.push(a),stackB.push(b),isArr){if(size=b.length,result=size==a.length)for(;size--&&(result=baseIsEqual(a[size],b[size],stackA,stackB)););}else forIn(b,function(value,key,b){return hasOwnProperty.call(b,key)?(size++,!(result=hasOwnProperty.call(a,key)&&baseIsEqual(a[key],value,stackA,stackB))&&indicatorObject):void 0}),result&&forIn(a,function(value,key,a){return hasOwnProperty.call(a,key)?!(result=--size>-1)&&indicatorObject:void 0});return stackA.pop(),stackB.pop(),result}function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1))}function baseUniq(array,isSorted,callback){for(var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[],seen=callback?[]:result;++index<length;){var value=array[index],computed=callback?callback(value,index,array):value;(isSorted?!index||seen[seen.length-1]!==computed:indexOf(seen,computed)<0)&&(callback&&seen.push(computed),result.push(value))}return result}function createAggregator(setter){return function(collection,callback,thisArg){var result={};callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length;){var value=collection[index];setter(result,value,callback(value,index,collection),collection)}else forOwn(collection,function(value,key,collection){setter(result,value,callback(value,key,collection),collection)});return result}}function createWrapper(func,bitmask,partialArgs,partialRightArgs,thisArg,arity){var isBindKey=2&bitmask,isPartial=16&bitmask,isPartialRight=32&bitmask;if(!isBindKey&&!isFunction(func))throw new TypeError;isPartial&&!partialArgs.length&&(bitmask&=-17,isPartial=partialArgs=!1),isPartialRight&&!partialRightArgs.length&&(bitmask&=-33,isPartialRight=partialRightArgs=!1);var creater=1==bitmask||17===bitmask?baseBind:baseCreateWrapper;return creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity])}function escapeHtmlChar(match){return htmlEscapes[match]}function getIndexOf(){var result=(result=lodash.indexOf)===indexOf?baseIndexOf:result;return result}function isNative(value){return"function"==typeof value&&reNative.test(value)}function unescapeHtmlChar(match){return htmlUnescapes[match]}function isArguments(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==argsClass||!1}function assign(object){if(!object)return object;for(var argsIndex=1,argsLength=arguments.length;argsLength>argsIndex;argsIndex++){var iterable=arguments[argsIndex];if(iterable)for(var key in iterable)object[key]=iterable[key]}return object}function clone(value){return isObject(value)?isArray(value)?slice(value):assign({},value):value}function defaults(object){if(!object)return object;for(var argsIndex=1,argsLength=arguments.length;argsLength>argsIndex;argsIndex++){var iterable=arguments[argsIndex];if(iterable)for(var key in iterable)"undefined"==typeof object[key]&&(object[key]=iterable[key])}return object}function functions(object){var result=[];return forIn(object,function(value,key){isFunction(value)&&result.push(key)}),result.sort()}function has(object,key){return object?hasOwnProperty.call(object,key):!1}function invert(object){for(var index=-1,props=keys(object),length=props.length,result={};++index<length;){var key=props[index];result[object[key]]=key}return result}function isBoolean(value){return value===!0||value===!1||value&&"object"==typeof value&&toString.call(value)==boolClass||!1}function isDate(value){return value&&"object"==typeof value&&toString.call(value)==dateClass||!1}function isElement(value){return value&&1===value.nodeType||!1}function isEmpty(value){if(!value)return!0;if(isArray(value)||isString(value))return!value.length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0}function isEqual(a,b){return baseIsEqual(a,b)}function isFinite(value){return nativeIsFinite(value)&&!nativeIsNaN(parseFloat(value))}function isFunction(value){return"function"==typeof value}function isObject(value){return!(!value||!objectTypes[typeof value])}function isNaN(value){return isNumber(value)&&value!=+value}function isNull(value){return null===value}function isNumber(value){return"number"==typeof value||value&&"object"==typeof value&&toString.call(value)==numberClass||!1}function isRegExp(value){return value&&objectTypes[typeof value]&&toString.call(value)==regexpClass||!1}function isString(value){return"string"==typeof value||value&&"object"==typeof value&&toString.call(value)==stringClass||!1}function isUndefined(value){return"undefined"==typeof value}function omit(object){var props=[];forIn(object,function(value,key){props.push(key)}),props=baseDifference(props,baseFlatten(arguments,!0,!1,1));for(var index=-1,length=props.length,result={};++index<length;){var key=props[index];result[key]=object[key]}return result}function pairs(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;){var key=props[index];result[index]=[key,object[key]]}return result}function pick(object){for(var index=-1,props=baseFlatten(arguments,!0,!1,1),length=props.length,result={};++index<length;){var key=props[index];key in object&&(result[key]=object[key])}return result}function values(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}function contains(collection,target){var indexOf=getIndexOf(),length=collection?collection.length:0,result=!1;return length&&"number"==typeof length?result=indexOf(collection,target)>-1:forOwn(collection,function(value){return(result=value===target)&&indicatorObject}),result}function every(collection,callback,thisArg){var result=!0;callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length&&(result=!!callback(collection[index],index,collection)););else forOwn(collection,function(value,index,collection){return!(result=!!callback(value,index,collection))&&indicatorObject});return result}function filter(collection,callback,thisArg){var result=[];callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length;){var value=collection[index];callback(value,index,collection)&&result.push(value)}else forOwn(collection,function(value,index,collection){callback(value,index,collection)&&result.push(value)});return result}function find(collection,callback,thisArg){callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"!=typeof length){var result;return forOwn(collection,function(value,index,collection){return callback(value,index,collection)?(result=value,indicatorObject):void 0}),result}for(;++index<length;){var value=collection[index];if(callback(value,index,collection))return value}}function findWhere(object,properties){return where(object,properties,!0)}function forEach(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;if(callback=callback&&"undefined"==typeof thisArg?callback:baseCreateCallback(callback,thisArg,3),"number"==typeof length)for(;++index<length&&callback(collection[index],index,collection)!==indicatorObject;);else forOwn(collection,callback)}function forEachRight(collection,callback){var length=collection?collection.length:0;if("number"==typeof length)for(;length--&&callback(collection[length],length,collection)!==!1;);else{var props=keys(collection);length=props.length,forOwn(collection,function(value,key,collection){return key=props?props[--length]:--length,callback(collection[key],key,collection)===!1&&indicatorObject})}}function invoke(collection,methodName){var args=slice(arguments,2),index=-1,isFunc="function"==typeof methodName,length=collection?collection.length:0,result=Array("number"==typeof length?length:0);return forEach(collection,function(value){result[++index]=(isFunc?methodName:value[methodName]).apply(value,args)}),result}function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;if(callback=createCallback(callback,thisArg,3),"number"==typeof length)for(var result=Array(length);++index<length;)result[index]=callback(collection[index],index,collection);else result=[],forOwn(collection,function(value,key,collection){result[++index]=callback(value,key,collection)});return result}function max(collection,callback,thisArg){var computed=-1/0,result=computed;"function"!=typeof callback&&thisArg&&thisArg[callback]===collection&&(callback=null);var index=-1,length=collection?collection.length:0;if(null==callback&&"number"==typeof length)for(;++index<length;){var value=collection[index];value>result&&(result=value)}else callback=createCallback(callback,thisArg,3),forEach(collection,function(value,index,collection){var current=callback(value,index,collection);current>computed&&(computed=current,result=value)});return result}function min(collection,callback,thisArg){var computed=1/0,result=computed;"function"!=typeof callback&&thisArg&&thisArg[callback]===collection&&(callback=null);var index=-1,length=collection?collection.length:0;if(null==callback&&"number"==typeof length)for(;++index<length;){var value=collection[index];result>value&&(result=value)}else callback=createCallback(callback,thisArg,3),forEach(collection,function(value,index,collection){var current=callback(value,index,collection);computed>current&&(computed=current,result=value)});return result}function reduce(collection,callback,accumulator,thisArg){if(!collection)return accumulator;var noaccum=arguments.length<3;callback=createCallback(callback,thisArg,4);var index=-1,length=collection.length;if("number"==typeof length)for(noaccum&&(accumulator=collection[++index]);++index<length;)accumulator=callback(accumulator,collection[index],index,collection);else forOwn(collection,function(value,index,collection){accumulator=noaccum?(noaccum=!1,value):callback(accumulator,value,index,collection)});return accumulator}function reduceRight(collection,callback,accumulator,thisArg){var noaccum=arguments.length<3;return callback=createCallback(callback,thisArg,4),forEachRight(collection,function(value,index,collection){accumulator=noaccum?(noaccum=!1,value):callback(accumulator,value,index,collection)}),accumulator}function reject(collection,callback,thisArg){return callback=createCallback(callback,thisArg,3),filter(collection,function(value,index,collection){return!callback(value,index,collection)})}function sample(collection,n,guard){if(collection&&"number"!=typeof collection.length&&(collection=values(collection)),null==n||guard)return collection?collection[baseRandom(0,collection.length-1)]:undefined;var result=shuffle(collection);return result.length=nativeMin(nativeMax(0,n),result.length),result}function shuffle(collection){var index=-1,length=collection?collection.length:0,result=Array("number"==typeof length?length:0);return forEach(collection,function(value){var rand=baseRandom(0,++index);result[index]=result[rand],result[rand]=value}),result}function size(collection){var length=collection?collection.length:0;return"number"==typeof length?length:keys(collection).length}function some(collection,callback,thisArg){var result;callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length&&!(result=callback(collection[index],index,collection)););else forOwn(collection,function(value,index,collection){return(result=callback(value,index,collection))&&indicatorObject});return!!result}function sortBy(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result=Array("number"==typeof length?length:0);for(callback=createCallback(callback,thisArg,3),forEach(collection,function(value,key,collection){result[++index]={criteria:[callback(value,key,collection)],index:index,value:value}}),length=result.length,result.sort(compareAscending);length--;)result[length]=result[length].value;return result}function toArray(collection){return isArray(collection)?slice(collection):collection&&"number"==typeof collection.length?map(collection):values(collection)}function where(collection,properties,first){return first&&isEmpty(properties)?undefined:(first?find:filter)(collection,properties)}function compact(array){for(var index=-1,length=array?array.length:0,result=[];++index<length;){var value=array[index];value&&result.push(value)}return result}function difference(array){return baseDifference(array,baseFlatten(arguments,!0,!0,1))}function first(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=-1;for(callback=createCallback(callback,thisArg,3);++index<length&&callback(array[index],index,array);)n++}else if(n=callback,null==n||thisArg)return array?array[0]:undefined;return slice(array,0,nativeMin(nativeMax(0,n),length))}function flatten(array,isShallow){return baseFlatten(array,isShallow)}function indexOf(array,value,fromIndex){if("number"==typeof fromIndex){var length=array?array.length:0;fromIndex=0>fromIndex?nativeMax(0,length+fromIndex):fromIndex||0}else if(fromIndex){var index=sortedIndex(array,value);return array[index]===value?index:-1}return baseIndexOf(array,value,fromIndex)}function initial(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=length;for(callback=createCallback(callback,thisArg,3);index--&&callback(array[index],index,array);)n++}else n=null==callback||thisArg?1:callback||n;return slice(array,0,nativeMin(nativeMax(0,length-n),length))}function intersection(){for(var args=[],argsIndex=-1,argsLength=arguments.length;++argsIndex<argsLength;){var value=arguments[argsIndex];(isArray(value)||isArguments(value))&&args.push(value)}var array=args[0],index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];outer:for(;++index<length;)if(value=array[index],indexOf(result,value)<0){for(var argsIndex=argsLength;--argsIndex;)if(indexOf(args[argsIndex],value)<0)continue outer;result.push(value)}return result}function last(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=length;for(callback=createCallback(callback,thisArg,3);index--&&callback(array[index],index,array);)n++}else if(n=callback,null==n||thisArg)return array?array[length-1]:undefined;return slice(array,nativeMax(0,length-n))}function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;for("number"==typeof fromIndex&&(index=(0>fromIndex?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1);index--;)if(array[index]===value)return index;return-1}function range(start,end,step){start=+start||0,step=+step||1,null==end&&(end=start,start=0);for(var index=-1,length=nativeMax(0,ceil((end-start)/step)),result=Array(length);++index<length;)result[index]=start,start+=step;return result}function rest(array,callback,thisArg){if("number"!=typeof callback&&null!=callback){var n=0,index=-1,length=array?array.length:0;for(callback=createCallback(callback,thisArg,3);++index<length&&callback(array[index],index,array);)n++}else n=null==callback||thisArg?1:nativeMax(0,callback);return slice(array,n)}function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low;for(callback=callback?createCallback(callback,thisArg,1):identity,value=callback(value);high>low;){var mid=low+high>>>1;callback(array[mid])<value?low=mid+1:high=mid}return low}function union(){return baseUniq(baseFlatten(arguments,!0,!0))}function uniq(array,isSorted,callback,thisArg){return"boolean"!=typeof isSorted&&null!=isSorted&&(thisArg=callback,callback="function"!=typeof isSorted&&thisArg&&thisArg[isSorted]===array?null:isSorted,isSorted=!1),null!=callback&&(callback=createCallback(callback,thisArg,3)),baseUniq(array,isSorted,callback)}function without(array){return baseDifference(array,slice(arguments,1))}function zip(){for(var index=-1,length=max(pluck(arguments,"length")),result=Array(0>length?0:length);++index<length;)result[index]=pluck(arguments,index);return result}function zipObject(keys,values){var index=-1,length=keys?keys.length:0,result={};for(values||!length||isArray(keys[0])||(values=[]);++index<length;){var key=keys[index];values?result[key]=values[index]:key&&(result[key[0]]=key[1])}return result}function after(n,func){if(!isFunction(func))throw new TypeError;return function(){return--n<1?func.apply(this,arguments):void 0}}function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg)}function bindAll(object){for(var funcs=arguments.length>1?baseFlatten(arguments,!0,!1,1):functions(object),index=-1,length=funcs.length;++index<length;){var key=funcs[index];object[key]=createWrapper(object[key],1,null,null,object)}return object}function compose(){for(var funcs=arguments,length=funcs.length;length--;)if(!isFunction(funcs[length]))throw new TypeError;return function(){for(var args=arguments,length=funcs.length;length--;)args=[funcs[length].apply(this,args)];return args[0]}}function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if(!isFunction(func))throw new TypeError;if(wait=nativeMax(0,wait)||0,options===!0){var leading=!0;trailing=!1}else isObject(options)&&(leading=options.leading,maxWait="maxWait"in options&&(nativeMax(wait,options.maxWait)||0),trailing="trailing"in options?options.trailing:trailing);var delayed=function(){var remaining=wait-(now()-stamp);if(0>=remaining){maxTimeoutId&&clearTimeout(maxTimeoutId);var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined,isCalled&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))}else timeoutId=setTimeout(delayed,remaining)},maxDelayed=function(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId=timeoutId=trailingCall=undefined,(trailing||maxWait!==wait)&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))};return function(){if(args=arguments,stamp=now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),maxWait===!1)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=0>=remaining;isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=null),result}}function defer(func){if(!isFunction(func))throw new TypeError;var args=slice(arguments,1);return setTimeout(function(){func.apply(undefined,args)},1)}function delay(func,wait){if(!isFunction(func))throw new TypeError;var args=slice(arguments,2);return setTimeout(function(){func.apply(undefined,args)},wait)}function memoize(func,resolver){var cache={};return function(){var key=resolver?resolver.apply(this,arguments):keyPrefix+arguments[0];return hasOwnProperty.call(cache,key)?cache[key]:cache[key]=func.apply(this,arguments)}}function once(func){var ran,result;if(!isFunction(func))throw new TypeError;return function(){return ran?result:(ran=!0,result=func.apply(this,arguments),func=null,result)}}function partial(func){return createWrapper(func,16,slice(arguments,1))}function throttle(func,wait,options){var leading=!0,trailing=!0;if(!isFunction(func))throw new TypeError;return options===!1?leading=!1:isObject(options)&&(leading="leading"in options?options.leading:leading,trailing="trailing"in options?options.trailing:trailing),options={},options.leading=leading,options.maxWait=wait,options.trailing=trailing,debounce(func,wait,options)}function wrap(value,wrapper){return createWrapper(wrapper,16,[value])}function createCallback(func,thisArg,argCount){var type=typeof func;if(null==func||"function"==type)return baseCreateCallback(func,thisArg,argCount);if("object"!=type)return property(func);var props=keys(func);return function(object){for(var length=props.length,result=!1;length--&&(result=object[props[length]]===func[props[length]]););return result}}function escape(string){return null==string?"":String(string).replace(reUnescapedHtml,escapeHtmlChar)}function identity(value){return value}function mixin(object){forEach(functions(object),function(methodName){var func=lodash[methodName]=object[methodName];lodash.prototype[methodName]=function(){var args=[this.__wrapped__];push.apply(args,arguments);var result=func.apply(lodash,args);return this.__chain__?new lodashWrapper(result,!0):result}})}function noConflict(){return root._=oldDash,this}function property(key){return function(object){return object[key]}}function random(min,max){return null==min&&null==max&&(max=1),min=+min||0,null==max?(max=min,min=0):max=+max||0,min+floor(nativeRandom()*(max-min+1))}function result(object,key){if(object){var value=object[key];return isFunction(value)?object[key]():value}}function template(text,data,options){var _=lodash,settings=_.templateSettings;text=String(text||""),options=defaults({},options,settings);var index=0,source="__p += '",variable=options.variable,reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+(options.interpolate||reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");text.replace(reDelimiters,function(match,escapeValue,interpolateValue,evaluateValue,offset){return source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(source+="' +\n_.escape("+escapeValue+") +\n'"),evaluateValue&&(source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n",variable||(variable="obj",source="with ("+variable+" || {}) {\n"+source+"\n}\n"),source="function("+variable+") {\nvar __t, __p = '', __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n"+source+"return __p\n}";try{var result=Function("_","return "+source)(_)}catch(e){throw e.source=source,e}return data?result(data):(result.source=source,result)}function times(n,callback,thisArg){n=(n=+n)>-1?n:0;var index=-1,result=Array(n);for(callback=baseCreateCallback(callback,thisArg,1);++index<n;)result[index]=callback(index);return result}function unescape(string){return null==string?"":String(string).replace(reEscapedHtml,unescapeHtmlChar)}function uniqueId(prefix){var id=++idCounter+"";return prefix?prefix+id:id}function chain(value){return value=new lodashWrapper(value),value.__chain__=!0,value}function tap(value,interceptor){return interceptor(value),value}function wrapperChain(){return this.__chain__=!0,this}function wrapperValueOf(){return this.__wrapped__}var undefined,idCounter=0,indicatorObject={},keyPrefix=+new Date+"",reInterpolate=/<%=([\s\S]+?)%>/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\t\u2028\u2029\\]/g,argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]",objectTypes={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal||(root=freeGlobal);var arrayRef=[],objectProto=Object.prototype,oldDash=root._,toString=objectProto.toString,reNative=RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),ceil=Math.ceil,floor=Math.floor,hasOwnProperty=objectProto.hasOwnProperty,push=arrayRef.push,propertyIsEnumerable=objectProto.propertyIsEnumerable,nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=root.isFinite,nativeIsNaN=root.isNaN,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeRandom=Math.random;lodashWrapper.prototype=lodash.prototype;var support={};!function(){var object={0:1,length:1};support.spliceObjects=(arrayRef.splice.call(object,0,1),!object[0])}(1),lodash.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:reInterpolate,variable:""},nativeCreate||(baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||root.Object()}}()),isArguments(arguments)||(isArguments=function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")||!1});var isArray=nativeIsArray||function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==arrayClass||!1},shimKeys=function(object){var index,iterable=object,result=[];if(!iterable)return result;if(!objectTypes[typeof object])return result;for(index in iterable)hasOwnProperty.call(iterable,index)&&result.push(index);return result},keys=nativeKeys?function(object){return isObject(object)?nativeKeys(object):[]}:shimKeys,htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},htmlUnescapes=invert(htmlEscapes),reEscapedHtml=RegExp("("+keys(htmlUnescapes).join("|")+")","g"),reUnescapedHtml=RegExp("["+keys(htmlEscapes).join("")+"]","g"),forIn=function(collection,callback){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;for(index in iterable)if(callback(iterable[index],index,collection)===indicatorObject)return result;return result},forOwn=function(collection,callback){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;for(index in iterable)if(hasOwnProperty.call(iterable,index)&&callback(iterable[index],index,collection)===indicatorObject)return result;return result};isFunction(/x/)&&(isFunction=function(value){return"function"==typeof value&&toString.call(value)==funcClass});var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key]++:result[key]=1}),groupBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value)}),indexBy=createAggregator(function(result,value,key){result[key]=value}),pluck=map,now=isNative(now=Date.now)&&now||function(){return(new Date).getTime()};lodash.after=after,lodash.bind=bind,lodash.bindAll=bindAll,lodash.chain=chain,lodash.compact=compact,lodash.compose=compose,lodash.countBy=countBy,lodash.debounce=debounce,lodash.defaults=defaults,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.filter=filter,lodash.flatten=flatten,lodash.forEach=forEach,lodash.functions=functions,lodash.groupBy=groupBy,lodash.indexBy=indexBy,lodash.initial=initial,lodash.intersection=intersection,lodash.invert=invert,lodash.invoke=invoke,lodash.keys=keys,lodash.map=map,lodash.max=max,lodash.memoize=memoize,lodash.min=min,lodash.omit=omit,lodash.once=once,lodash.pairs=pairs,lodash.partial=partial,lodash.pick=pick,lodash.pluck=pluck,lodash.range=range,lodash.reject=reject,lodash.rest=rest,lodash.shuffle=shuffle,lodash.sortBy=sortBy,lodash.tap=tap,lodash.throttle=throttle,lodash.times=times,lodash.toArray=toArray,lodash.union=union,lodash.uniq=uniq,lodash.values=values,lodash.where=where,lodash.without=without,lodash.wrap=wrap,lodash.zip=zip,lodash.collect=map,lodash.drop=rest,lodash.each=forEach,lodash.extend=assign,lodash.methods=functions,lodash.object=zipObject,lodash.select=filter,lodash.tail=rest,lodash.unique=uniq,lodash.clone=clone,lodash.contains=contains,lodash.escape=escape,lodash.every=every,lodash.find=find,lodash.has=has,lodash.identity=identity,lodash.indexOf=indexOf,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isBoolean=isBoolean,lodash.isDate=isDate,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isNaN=isNaN,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isRegExp=isRegExp,lodash.isString=isString,lodash.isUndefined=isUndefined,lodash.lastIndexOf=lastIndexOf,lodash.mixin=mixin,lodash.noConflict=noConflict,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.result=result,lodash.size=size,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.template=template,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.all=every,lodash.any=some,lodash.detect=find,lodash.findWhere=findWhere,lodash.foldl=reduce,lodash.foldr=reduceRight,lodash.include=contains,lodash.inject=reduce,lodash.first=first,lodash.last=last,lodash.sample=sample,lodash.take=first,lodash.head=first,mixin(lodash),lodash.VERSION="2.4.1",lodash.prototype.chain=wrapperChain,lodash.prototype.value=wrapperValueOf,forEach(["pop","push","reverse","shift","sort","splice","unshift"],function(methodName){var func=arrayRef[methodName];
lodash.prototype[methodName]=function(){var value=this.__wrapped__;return func.apply(value,arguments),support.spliceObjects||0!==value.length||delete value[0],this}}),forEach(["concat","join","slice"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__,result=func.apply(value,arguments);return this.__chain__&&(result=new lodashWrapper(result),result.__chain__=!0),result}}),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(root._=lodash,define(function(){return lodash})):freeExports&&freeModule?moduleExports?(freeModule.exports=lodash)._=lodash:freeExports._=lodash:root._=lodash}).call(this),function(root,factory){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)});else if("undefined"!=typeof exports){var _=require("underscore");factory(root,exports,_)}else root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}(this,function(root,Backbone,_,$){{var previousBackbone=root.Backbone,array=[],slice=(array.push,array.slice);array.splice}Backbone.VERSION="1.1.2",Backbone.$=$,Backbone.noConflict=function(){return root.Backbone=previousBackbone,this},Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);return events.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_.once(function(){self.off(name,once),callback.apply(this,arguments)});return once._callback=callback,this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events=void 0,this;for(names=name?[name]:_.keys(this._events),i=0,l=names.length;l>i;i++)if(name=names[i],events=this._events[name]){if(this._events[name]=retain=[],callback||context)for(j=0,k=events.length;k>j;j++)ev=events[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev);retain.length||delete this._events[name]}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;return events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;callback||"object"!=typeof name||(callback=this),obj&&((listeningTo={})[obj._listenId]=obj);for(var id in listeningTo)obj=listeningTo[id],obj.off(name,callback,this),(remove||_.isEmpty(obj._events))&&delete this._listeningTo[id];return this}},eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name){for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args);return}},listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={}),id=obj._listenId||(obj._listenId=_.uniqueId("l"));return listeningTo[id]=obj,callback||"object"!=typeof name||(callback=this),obj[implementation](name,callback,this),this}}),Events.bind=Events.on,Events.unbind=Events.off,_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={}),this.cid=_.uniqueId("c"),this.attributes={},options.collection&&(this.collection=options.collection),options.parse&&(attrs=this.parse(attrs,options)||{}),attrs=_.defaults({},attrs,_.result(this,"defaults")),this.set(attrs,options),this.changed={},this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return null!=this.get(attr)},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(null==key)return this;if("object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options||(options={}),!this._validate(attrs,options))return!1;unset=options.unset,silent=options.silent,changes=[],changing=this._changing,this._changing=!0,changing||(this._previousAttributes=_.clone(this.attributes),this.changed={}),current=this.attributes,prev=this._previousAttributes,this.idAttribute in attrs&&(this.id=attrs[this.idAttribute]);for(attr in attrs)val=attrs[attr],_.isEqual(current[attr],val)||changes.push(attr),_.isEqual(prev[attr],val)?delete this.changed[attr]:this.changed[attr]=val,unset?delete current[attr]:current[attr]=val;if(!silent){changes.length&&(this._pending=options);for(var i=0,l=changes.length;l>i;i++)this.trigger("change:"+changes[i],this,current[changes[i]],options)}if(changing)return this;if(!silent)for(;this._pending;)options=this._pending,this._pending=!1,this.trigger("change",this,options);return this._pending=!1,this._changing=!1,this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:!0}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:!0}))},hasChanged:function(attr){return null==attr?!_.isEmpty(this.changed):_.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):!1;var val,changed=!1,old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff)_.isEqual(old[attr],val=diff[attr])||((changed||(changed={}))[attr]=val);return changed},previous:function(attr){return null!=attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){return model.set(model.parse(resp,options),options)?(success&&success(model,resp,options),void model.trigger("sync",model,resp,options)):!1},wrapError(this,options),this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(null==key||"object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options=_.extend({validate:!0},options),attrs&&!options.wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;attrs&&options.wait&&(this.attributes=_.extend({},attributes,attrs)),void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);return options.wait&&(serverAttrs=_.extend(attrs||{},serverAttrs)),_.isObject(serverAttrs)&&!model.set(serverAttrs,options)?!1:(success&&success(model,resp,options),void model.trigger("sync",model,resp,options))},wrapError(this,options),method=this.isNew()?"create":options.patch?"patch":"update","patch"===method&&(options.attrs=attrs),xhr=this.sync(method,this,options),attrs&&options.wait&&(this.attributes=attributes),xhr},destroy:function(options){options=options?_.clone(options):{};var model=this,success=options.success,destroy=function(){model.trigger("destroy",model,model.collection,options)};if(options.success=function(resp){(options.wait||model.isNew())&&destroy(),success&&success(model,resp,options),model.isNew()||model.trigger("sync",model,resp,options)},this.isNew())return options.success(),!1;wrapError(this,options);var xhr=this.sync("delete",this,options);return options.wait||destroy(),xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();return this.isNew()?base:base.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(resp){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend(options||{},{validate:!0}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;return error?(this.trigger("invalid",this,error,_.extend(options,{validationError:error})),!1):!0}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.attributes),_[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={}),options.model&&(this.model=options.model),void 0!==options.comparator&&(this.comparator=options.comparator),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,_.extend({silent:!0},options))},setOptions={add:!0,remove:!0,merge:!0},addOptions={add:!0,remove:!1};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:!1},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models),options||(options={});var i,l,index,model;for(i=0,l=models.length;l>i;i++)model=models[i]=this.get(models[i]),model&&(delete this._byId[model.id],delete this._byId[model.cid],index=this.indexOf(model),this.models.splice(index,1),this.length--,options.silent||(options.index=index,model.trigger("remove",model,this,options)),this._removeReference(model,options));return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions),options.parse&&(models=this.parse(models,options));var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort,at=options.at,targetModel=this.model,sortable=this.comparator&&null==at&&options.sort!==!1,sortAttr=_.isString(this.comparator)?this.comparator:null,toAdd=[],toRemove=[],modelMap={},add=options.add,merge=options.merge,remove=options.remove,order=!sortable&&add&&remove?[]:!1;for(i=0,l=models.length;l>i;i++){if(attrs=models[i]||{},id=attrs instanceof Model?model=attrs:attrs[targetModel.prototype.idAttribute||"id"],existing=this.get(id))remove&&(modelMap[existing.cid]=!0),merge&&(attrs=attrs===model?model.attributes:attrs,options.parse&&(attrs=existing.parse(attrs,options)),existing.set(attrs,options),sortable&&!sort&&existing.hasChanged(sortAttr)&&(sort=!0)),models[i]=existing;else if(add){if(model=models[i]=this._prepareModel(attrs,options),!model)continue;toAdd.push(model),this._addReference(model,options)}model=existing||model,!order||!model.isNew()&&modelMap[model.id]||order.push(model),modelMap[model.id]=!0}if(remove){for(i=0,l=this.length;l>i;++i)modelMap[(model=this.models[i]).cid]||toRemove.push(model);toRemove.length&&this.remove(toRemove,options)}if(toAdd.length||order&&order.length)if(sortable&&(sort=!0),this.length+=toAdd.length,null!=at)for(i=0,l=toAdd.length;l>i;i++)this.models.splice(at+i,0,toAdd[i]);else{order&&(this.models.length=0);var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;l>i;i++)this.models.push(orderedModels[i])}if(sort&&this.sort({silent:!0}),!options.silent){for(i=0,l=toAdd.length;l>i;i++)(model=toAdd[i]).trigger("add",model,this,options);(sort||order&&order.length)&&this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;l>i;i++)this._removeReference(this.models[i],options);return options.previousModels=this.models,this._reset(),models=this.add(models,_.extend({silent:!0},options)),options.silent||this.trigger("reset",this,options),models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options),model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options),model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){return null==obj?void 0:this._byId[obj]||this._byId[obj.id]||this._byId[obj.cid]},at:function(index){return this.models[index]},where:function(attrs,first){return _.isEmpty(attrs)?first?void 0:[]:this[first?"find":"filter"](function(model){for(var key in attrs)if(attrs[key]!==model.get(key))return!1;return!0})},findWhere:function(attrs){return this.where(attrs,!0)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return options||(options={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this)),options.silent||this.trigger("sort",this,options),this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var success=options.success,collection=this;return options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options),success&&success(collection,resp,options),collection.trigger("sync",collection,resp,options)},wrapError(this,options),this.sync("read",this,options)},create:function(model,options){if(options=options?_.clone(options):{},!(model=this._prepareModel(model,options)))return!1;options.wait||this.add(model,options);var collection=this,success=options.success;return options.success=function(model,resp){options.wait&&collection.add(model,options),success&&success(model,resp,options)},model.save(null,options),model},parse:function(resp){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model)return attrs;options=options?_.clone(options):{},options.collection=this;var model=new this.model(attrs,options);return model.validationError?(this.trigger("invalid",this,model.validationError,options),!1):model},_addReference:function(model){this._byId[model.cid]=model,null!=model.id&&(this._byId[model.id]=model),model.collection||(model.collection=this),model.on("all",this._onModelEvent,this)},_removeReference:function(model){this===model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){("add"!==event&&"remove"!==event||collection===this)&&("destroy"===event&&this.remove(model,options),model&&event==="change:"+model.idAttribute&&(delete this._byId[model.previous(model.idAttribute)],null!=model.id&&(this._byId[model.id]=model)),this.trigger.apply(this,arguments))}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.models),_[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy","indexBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view"),options||(options={}),_.extend(this,_.pick(options,viewOptions)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(element,delegate){return this.$el&&this.undelegateEvents(),this.$el=element instanceof Backbone.$?element:Backbone.$(element),this.el=this.$el[0],delegate!==!1&&this.delegateEvents(),this},delegateEvents:function(events){if(!events&&!(events=_.result(this,"events")))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(_.isFunction(method)||(method=this[events[key]]),method){var match=key.match(delegateEventSplitter),eventName=match[1],selector=match[2];method=_.bind(method,this),eventName+=".delegateEvents"+this.cid,""===selector?this.$el.on(eventName,method):this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"),!1);else{var attrs=_.extend({},_.result(this,"attributes"));this.id&&(attrs.id=_.result(this,"id")),this.className&&(attrs["class"]=_.result(this,"className"));var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,!1)}}}),Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(options.url||(params.url=_.result(model,"url")||urlError()),null!=options.data||!model||"create"!==method&&"update"!==method&&"patch"!==method||(params.contentType="application/json",params.data=JSON.stringify(options.attrs||model.toJSON(options))),options.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.data=params.data?{model:params.data}:{}),options.emulateHTTP&&("PUT"===type||"DELETE"===type||"PATCH"===type)){params.type="POST",options.emulateJSON&&(params.data._method=type);var beforeSend=options.beforeSend;options.beforeSend=function(xhr){return xhr.setRequestHeader("X-HTTP-Method-Override",type),beforeSend?beforeSend.apply(this,arguments):void 0}}"GET"===params.type||options.emulateJSON||(params.processData=!1),"PATCH"===params.type&&noXhrPatch&&(params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var xhr=options.xhr=Backbone.ajax(_.extend(params,options));return model.trigger("request",model,xhr,options),xhr};var noXhrPatch=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={}),options.routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){_.isRegExp(route)||(route=this._routeToRegExp(route)),_.isFunction(name)&&(callback=name,name=""),callback||(callback=this[name]);var router=this;return Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);router.execute(callback,args),router.trigger.apply(router,["route:"+name].concat(args)),router.trigger("route",name,args),Backbone.history.trigger("route",router,name,args)}),this},execute:function(callback,args){callback&&callback.apply(this,args)},navigate:function(fragment,options){return Backbone.history.navigate(fragment,options),this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var route,routes=_.keys(this.routes);null!=(route=routes.pop());)this.route(route,this.routes[route])}},_routeToRegExp:function(route){return route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)"),new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){return i===params.length-1?param||null:param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[],_.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,pathStripper=/#.*$/;History.started=!1,_.extend(History.prototype,Events,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(null==fragment)if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=decodeURI(this.location.pathname+this.location.search);var root=this.root.replace(trailingSlash,"");fragment.indexOf(root)||(fragment=fragment.slice(root.length))}else fragment=this.getHash();return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=!0,this.options=_.extend({root:"/"},this.options,options),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment(),docMode=document.documentMode,oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||7>=docMode);if(this.root=("/"+this.root+"/").replace(rootStripper,"/"),oldIE&&this._wantsHashChange){var frame=Backbone.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=frame.hide().appendTo("body")[0].contentWindow,this.navigate(fragment)}this._hasPushState?Backbone.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!oldIE?Backbone.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=fragment;var loc=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&loc.hash&&(this.fragment=this.getHash().replace(routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(){var current=this.getFragment();return current===this.fragment&&this.iframe&&(current=this.getFragment(this.getHash(this.iframe))),current===this.fragment?!1:(this.iframe&&this.navigate(current),void this.loadUrl())},loadUrl:function(fragment){return fragment=this.fragment=this.getFragment(fragment),_.any(this.handlers,function(handler){return handler.route.test(fragment)?(handler.callback(fragment),!0):void 0})},navigate:function(fragment,options){if(!History.started)return!1;options&&options!==!0||(options={trigger:!!options});var url=this.root+(fragment=this.getFragment(fragment||""));if(fragment=fragment.replace(pathStripper,""),this.fragment!==fragment){if(this.fragment=fragment,""===fragment&&"/"!==url&&(url=url.slice(0,-1)),this._hasPushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))&&(options.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,fragment,options.replace))}return options.trigger?this.loadUrl(fragment):void 0}},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else location.hash="#"+fragment}}),Backbone.history=new History;var extend=function(protoProps,staticProps){var child,parent=this;child=protoProps&&_.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&_.extend(child.prototype,protoProps),child.__super__=parent.prototype,child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')},wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error(model,resp,options),model.trigger("error",model,resp,options)}};return Backbone}),function(root){if("undefined"!=typeof exports&&"undefined"!=typeof require)var $=root.jQuery||root.Zepto||root.ender||require("jquery"),_=root._||require("underscore"),Backbone=root.Backbone||require("backbone");else var $=root.jQuery,_=root._,Backbone=root.Backbone;var Form=Backbone.View.extend({initialize:function(options){var self=this;options=options||{};var schema=this.schema=function(){if(options.schema)return _.result(options,"schema");var model=options.model;return model&&model.schema?_.isFunction(model.schema)?model.schema():model.schema:self.schema?_.isFunction(self.schema)?self.schema():self.schema:{}}();_.extend(this,_.pick(options,"model","data","idPrefix","templateData"));var constructor=this.constructor;this.template=options.template||this.template||constructor.template,this.Fieldset=options.Fieldset||this.Fieldset||constructor.Fieldset,this.Field=options.Field||this.Field||constructor.Field,this.NestedField=options.NestedField||this.NestedField||constructor.NestedField;var selectedFields=this.selectedFields=options.fields||_.keys(schema),fields=this.fields={};_.each(selectedFields,function(key){var fieldSchema=schema[key];fields[key]=this.createField(key,fieldSchema)},this);{var fieldsetSchema=options.fieldsets||[selectedFields];this.fieldsets=[]}_.each(fieldsetSchema,function(itemSchema){this.fieldsets.push(this.createFieldset(itemSchema))},this)},createFieldset:function(schema){var options={schema:schema,fields:this.fields};return new this.Fieldset(options)},createField:function(key,schema){var options={form:this,key:key,schema:schema,idPrefix:this.idPrefix};this.model?options.model=this.model:options.value=this.data?this.data[key]:null;var field=new this.Field(options);return this.listenTo(field.editor,"all",this.handleEditorEvent),field},handleEditorEvent:function(event,editor){var formEvent=editor.key+":"+event;switch(this.trigger.call(this,formEvent,this,editor,Array.prototype.slice.call(arguments,2)),event){case"change":this.trigger("change",this);break;case"focus":this.hasFocus||this.trigger("focus",this);break;case"blur":if(this.hasFocus){var self=this;setTimeout(function(){var focusedField=_.find(self.fields,function(field){return field.editor.hasFocus});focusedField||self.trigger("blur",self)},0)}}},render:function(){var self=this,fields=this.fields,$form=$($.trim(this.template(_.result(this,"templateData"))));return $form.find("[data-editors]").add($form).each(function(i,el){var $container=$(el),selection=$container.attr("data-editors");if(!_.isUndefined(selection)){var keys="*"==selection?self.selectedFields||_.keys(fields):selection.split(",");_.each(keys,function(key){var field=fields[key];$container.append(field.editor.render().el)})}}),$form.find("[data-fields]").add($form).each(function(i,el){var $container=$(el),selection=$container.attr("data-fields");if(!_.isUndefined(selection)){var keys="*"==selection?self.selectedFields||_.keys(fields):selection.split(",");_.each(keys,function(key){var field=fields[key];$container.append(field.render().el)})}}),$form.find("[data-fieldsets]").add($form).each(function(i,el){var $container=$(el),selection=$container.attr("data-fieldsets");_.isUndefined(selection)||_.each(self.fieldsets,function(fieldset){$container.append(fieldset.render().el)})}),this.setElement($form),$form.addClass(this.className),this},validate:function(options){var fields=this.fields,model=this.model,errors={};if(options=options||{},_.each(fields,function(field){var error=field.validate();error&&(errors[field.key]=error)}),!options.skipModelValidate&&model&&model.validate){var modelErrors=model.validate(this.getValue());if(modelErrors){var isDictionary=_.isObject(modelErrors)&&!_.isArray(modelErrors);isDictionary||(errors._others=errors._others||[],errors._others.push(modelErrors)),isDictionary&&_.each(modelErrors,function(val,key){if(fields[key]&&!errors[key])fields[key].setError(val),errors[key]=val;else{errors._others=errors._others||[];var tmpErr={};tmpErr[key]=val,errors._others.push(tmpErr)}})}}return _.isEmpty(errors)?null:errors},commit:function(options){options=options||{};var validateOptions={skipModelValidate:!options.validate},errors=this.validate(validateOptions);if(errors)return errors;var modelError,setOptions=_.extend({error:function(model,e){modelError=e}},options);return this.model.set(this.getValue(),setOptions),modelError?modelError:void 0},getValue:function(key){if(key)return this.fields[key].getValue();var values={};return _.each(this.fields,function(field){values[field.key]=field.getValue()}),values},setValue:function(prop,val){var data={};"string"==typeof prop?data[prop]=val:data=prop;var key;for(key in this.schema)void 0!==data[key]&&this.fields[key].setValue(data[key])},getEditor:function(key){var field=this.fields[key];if(!field)throw new Error("Field not found: "+key);return field.editor},focus:function(){if(!this.hasFocus){var fieldset=this.fieldsets[0],field=fieldset.getFieldAt(0);field&&field.editor.focus()}},blur:function(){if(this.hasFocus){var focusedField=_.find(this.fields,function(field){return field.editor.hasFocus});focusedField&&focusedField.editor.blur()}},trigger:function(event){return"focus"===event?this.hasFocus=!0:"blur"===event&&(this.hasFocus=!1),Backbone.View.prototype.trigger.apply(this,arguments)},remove:function(){return _.each(this.fieldsets,function(fieldset){fieldset.remove()
}),_.each(this.fields,function(field){field.remove()}),Backbone.View.prototype.remove.apply(this,arguments)}},{template:_.template("    <form data-fieldsets></form>  ",null,this.templateSettings),templateSettings:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},editors:{}});Form.validators=function(){var validators={};return validators.errMessages={required:"Required",regexp:"Invalid",email:"Invalid email address",url:"Invalid URL",match:_.template('Must match field "<%= field %>"',null,Form.templateSettings)},validators.required=function(options){return options=_.extend({type:"required",message:this.errMessages.required},options),function(value){options.value=value;var err={type:options.type,message:_.isFunction(options.message)?options.message(options):options.message};return null===value||void 0===value||value===!1||""===value?err:void 0}},validators.regexp=function(options){if(!options.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return options=_.extend({type:"regexp",message:this.errMessages.regexp},options),function(value){options.value=value;var err={type:options.type,message:_.isFunction(options.message)?options.message(options):options.message};if(null!==value&&void 0!==value&&""!==value)return options.regexp.test(value)?void 0:err}},validators.email=function(options){return options=_.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},options),validators.regexp(options)},validators.url=function(options){return options=_.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i},options),validators.regexp(options)},validators.match=function(options){if(!options.field)throw new Error('Missing required "field" options for "match" validator');return options=_.extend({type:"match",message:this.errMessages.match},options),function(value,attrs){options.value=value;var err={type:options.type,message:_.isFunction(options.message)?options.message(options):options.message};if(null!==value&&void 0!==value&&""!==value)return value!==attrs[options.field]?err:void 0}},validators}(),Form.Fieldset=Backbone.View.extend({initialize:function(options){options=options||{};var schema=this.schema=this.createSchema(options.schema);this.fields=_.pick(options.fields,schema.fields),this.template=options.template||this.constructor.template},createSchema:function(schema){return _.isArray(schema)&&(schema={fields:schema}),schema.legend=schema.legend||null,schema},getFieldAt:function(index){var key=this.schema.fields[index];return this.fields[key]},templateData:function(){return this.schema},render:function(){var fields=(this.schema,this.fields),$fieldset=$($.trim(this.template(_.result(this,"templateData"))));return $fieldset.find("[data-fields]").add($fieldset).each(function(i,el){var $container=$(el),selection=$container.attr("data-fields");_.isUndefined(selection)||_.each(fields,function(field){$container.append(field.render().el)})}),this.setElement($fieldset),this},remove:function(){_.each(this.fields,function(field){field.remove()}),Backbone.View.prototype.remove.call(this)}},{template:_.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  ",null,Form.templateSettings)}),Form.Field=Backbone.View.extend({initialize:function(options){options=options||{},_.extend(this,_.pick(options,"form","key","model","value","idPrefix"));var schema=this.schema=this.createSchema(options.schema);this.template=options.template||schema.template||this.constructor.template,this.errorClassName=options.errorClassName||this.constructor.errorClassName,this.editor=this.createEditor()},createSchema:function(schema){return _.isString(schema)&&(schema={type:schema}),schema=_.extend({type:"Text",title:this.createTitle()},schema),schema.type=_.isString(schema.type)?Form.editors[schema.type]:schema.type,schema},createEditor:function(){var options=_.extend(_.pick(this,"schema","form","key","model","value"),{id:this.createEditorId()}),constructorFn=this.schema.type;return new constructorFn(options)},createEditorId:function(){var prefix=this.idPrefix,id=this.key;return id=id.replace(/\./g,"_"),_.isString(prefix)||_.isNumber(prefix)?prefix+id:_.isNull(prefix)?id:this.model?this.model.cid+"_"+id:id},createTitle:function(){var str=this.key;return str=str.replace(/([A-Z])/g," $1"),str=str.replace(/^./,function(str){return str.toUpperCase()})},templateData:function(){var schema=this.schema;return{help:schema.help||"",title:schema.title,fieldAttrs:schema.fieldAttrs,editorAttrs:schema.editorAttrs,key:this.key,editorId:this.editor.id}},render:function(){var schema=this.schema,editor=this.editor;if(schema.type==Form.editors.Hidden)return this.setElement(editor.render().el);var $field=$($.trim(this.template(_.result(this,"templateData"))));return schema.fieldClass&&$field.addClass(schema.fieldClass),schema.fieldAttrs&&$field.attr(schema.fieldAttrs),$field.find("[data-editor]").add($field).each(function(i,el){var $container=$(el),selection=$container.attr("data-editor");_.isUndefined(selection)||$container.append(editor.render().el)}),this.setElement($field),this},validate:function(){var error=this.editor.validate();return error?this.setError(error.message):this.clearError(),error},setError:function(msg){this.editor.hasNestedForm||(this.$el.addClass(this.errorClassName),this.$("[data-error]").html(msg))},clearError:function(){this.$el.removeClass(this.errorClassName),this.$("[data-error]").empty()},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(value){this.editor.setValue(value)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)}},{template:_.template('    <div>      <label for="<%= editorId %>"><%= title %></label>      <div>        <span data-editor></span>        <div data-error></div>        <div><%= help %></div>      </div>    </div>  ',null,Form.templateSettings),errorClassName:"error"}),Form.NestedField=Form.Field.extend({template:_.template($.trim("    <div>      <span data-editor></span>      <% if (help) { %>        <div><%= help %></div>      <% } %>      <div data-error></div>    </div>  "),null,Form.templateSettings)}),Form.Editor=Form.editors.Base=Backbone.View.extend({defaultValue:null,hasFocus:!1,initialize:function(options){var options=options||{};if(options.model){if(!options.key)throw new Error("Missing option: 'key'");this.model=options.model,this.value=this.model.get(options.key)}else void 0!==options.value&&(this.value=options.value);void 0===this.value&&(this.value=this.defaultValue),_.extend(this,_.pick(options,"key","form"));var schema=this.schema=options.schema||{};this.validators=options.validators||schema.validators,this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),schema.editorClass&&this.$el.addClass(schema.editorClass),schema.editorAttrs&&this.$el.attr(schema.editorAttrs)},getName:function(){var key=this.key||"";return key.replace(/\./g,"_")},getValue:function(){return this.value},setValue:function(value){this.value=value},focus:function(){throw new Error("Not implemented")},blur:function(){throw new Error("Not implemented")},commit:function(options){var error=this.validate();return error?error:(this.listenTo(this.model,"invalid",function(model,e){error=e}),this.model.set(this.key,this.getValue(),options),error?error:void 0)},validate:function(){var error=(this.$el,null),value=this.getValue(),formValues=this.form?this.form.getValue():{},validators=this.validators,getValidator=this.getValidator;return validators&&_.every(validators,function(validator){return error=getValidator(validator)(value,formValues),error?!1:!0}),error},trigger:function(event){return"focus"===event?this.hasFocus=!0:"blur"===event&&(this.hasFocus=!1),Backbone.View.prototype.trigger.apply(this,arguments)},getValidator:function(validator){var validators=Form.validators;if(_.isRegExp(validator))return validators.regexp({regexp:validator});if(_.isString(validator)){if(!validators[validator])throw new Error('Validator "'+validator+'" not found');return validators[validator]()}if(_.isFunction(validator))return validator;if(_.isObject(validator)&&validator.type){var config=validator;return validators[config.type](config)}throw new Error("Invalid validator: "+validator)}}),Form.editors.Text=Form.Editor.extend({tagName:"input",defaultValue:"",previousValue:"",events:{keyup:"determineChange",keypress:function(){var self=this;setTimeout(function(){self.determineChange()},0)},select:function(){this.trigger("select",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(options){Form.editors.Base.prototype.initialize.call(this,options);var schema=this.schema,type="text";schema&&schema.editorAttrs&&schema.editorAttrs.type&&(type=schema.editorAttrs.type),schema&&schema.dataType&&(type=schema.dataType),this.$el.attr("type",type)},render:function(){return this.setValue(this.value),this},determineChange:function(){var currentValue=this.$el.val(),changed=currentValue!==this.previousValue;changed&&(this.previousValue=currentValue,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(value){this.$el.val(value)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},select:function(){this.$el.select()}}),Form.editors.TextArea=Form.editors.Text.extend({tagName:"textarea",initialize:function(options){Form.editors.Base.prototype.initialize.call(this,options)}}),Form.editors.Password=Form.editors.Text.extend({initialize:function(options){Form.editors.Text.prototype.initialize.call(this,options),this.$el.attr("type","password")}}),Form.editors.Number=Form.editors.Text.extend({defaultValue:0,events:_.extend({},Form.editors.Text.prototype.events,{keypress:"onKeyPress",change:"onKeyPress"}),initialize:function(options){Form.editors.Text.prototype.initialize.call(this,options);var schema=this.schema;this.$el.attr("type","number"),schema&&schema.editorAttrs&&schema.editorAttrs.step||this.$el.attr("step","any")},onKeyPress:function(event){var self=this,delayedDetermineChange=function(){setTimeout(function(){self.determineChange()},0)};if(0===event.charCode)return void delayedDetermineChange();var newVal=this.$el.val();void 0!=event.charCode&&(newVal+=String.fromCharCode(event.charCode));var numeric=/^[0-9]*\.?[0-9]*?$/.test(newVal);numeric?delayedDetermineChange():event.preventDefault()},getValue:function(){var value=this.$el.val();return""===value?null:parseFloat(value,10)},setValue:function(value){value=function(){return _.isNumber(value)?value:_.isString(value)&&""!==value?parseFloat(value,10):null}(),_.isNaN(value)&&(value=null),Form.editors.Text.prototype.setValue.call(this,value)}}),Form.editors.Hidden=Form.editors.Text.extend({defaultValue:"",initialize:function(options){Form.editors.Text.prototype.initialize.call(this,options),this.$el.attr("type","hidden")},focus:function(){},blur:function(){}}),Form.editors.Checkbox=Form.editors.Base.extend({defaultValue:!1,tagName:"input",events:{click:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(options){Form.editors.Base.prototype.initialize.call(this,options),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.prop("checked")},setValue:function(value){value?this.$el.prop("checked",!0):this.$el.prop("checked",!1)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()}}),Form.editors.Select=Form.editors.Base.extend({tagName:"select",events:{change:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)}},initialize:function(options){if(Form.editors.Base.prototype.initialize.call(this,options),!this.schema||!this.schema.options)throw new Error("Missing required 'schema.options'")},render:function(){return this.setOptions(this.schema.options),this},setOptions:function(options){var self=this;if(options instanceof Backbone.Collection){var collection=options;collection.length>0?this.renderOptions(options):collection.fetch({success:function(){self.renderOptions(options)}})}else _.isFunction(options)?options(function(result){self.renderOptions(result)},self):this.renderOptions(options)},renderOptions:function(options){var html,$select=this.$el;html=this._getOptionsHtml(options),$select.html(html),this.setValue(this.value)},_getOptionsHtml:function(options){var html;if(_.isString(options))html=options;else if(_.isArray(options))html=this._arrayToHtml(options);else if(options instanceof Backbone.Collection)html=this._collectionToHtml(options);else if(_.isFunction(options)){var newOptions;options(function(opts){newOptions=opts},this),html=this._getOptionsHtml(newOptions)}else html=this._objectToHtml(options);return html},getValue:function(){return this.$el.val()},setValue:function(value){this.$el.val(value)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},_collectionToHtml:function(collection){var array=[];collection.each(function(model){array.push({val:model.id,label:model.toString()})});var html=this._arrayToHtml(array);return html},_objectToHtml:function(obj){var array=[];for(var key in obj)obj.hasOwnProperty(key)&&array.push({val:key,label:obj[key]});var html=this._arrayToHtml(array);return html},_arrayToHtml:function(array){var html=[];return _.each(array,function(option){if(_.isObject(option))if(option.group)html.push('<optgroup label="'+option.group+'">'),html.push(this._getOptionsHtml(option.options)),html.push("</optgroup>");else{var val=option.val||0===option.val?option.val:"";html.push('<option value="'+val+'">'+option.label+"</option>")}else html.push("<option>"+option+"</option>")},this),html.join("")}}),Form.editors.Radio=Form.editors.Select.extend({tagName:"ul",events:{"change input[type=radio]":function(){this.trigger("change",this)},"focus input[type=radio]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=radio]":function(){if(this.hasFocus){var self=this;setTimeout(function(){self.$("input[type=radio]:focus")[0]||self.trigger("blur",self)},0)}}},getValue:function(){return this.$("input[type=radio]:checked").val()},setValue:function(value){this.$("input[type=radio]").val([value])},focus:function(){if(!this.hasFocus){var checked=this.$("input[type=radio]:checked");return checked[0]?void checked.focus():void this.$("input[type=radio]").first().focus()}},blur:function(){this.hasFocus&&this.$("input[type=radio]:focus").blur()},_arrayToHtml:function(array){var html=[],self=this;return _.each(array,function(option,index){var itemHtml="<li>";if(_.isObject(option)){var val=option.val||0===option.val?option.val:"";itemHtml+='<input type="radio" name="'+self.getName()+'" value="'+val+'" id="'+self.id+"-"+index+'" />',itemHtml+='<label for="'+self.id+"-"+index+'">'+option.label+"</label>"}else itemHtml+='<input type="radio" name="'+self.getName()+'" value="'+option+'" id="'+self.id+"-"+index+'" />',itemHtml+='<label for="'+self.id+"-"+index+'">'+option+"</label>";itemHtml+="</li>",html.push(itemHtml)}),html.join("")}}),Form.editors.Checkboxes=Form.editors.Select.extend({tagName:"ul",groupNumber:0,events:{"click input[type=checkbox]":function(){this.trigger("change",this)},"focus input[type=checkbox]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=checkbox]":function(){if(this.hasFocus){var self=this;setTimeout(function(){self.$("input[type=checkbox]:focus")[0]||self.trigger("blur",self)},0)}}},getValue:function(){var values=[];return this.$("input[type=checkbox]:checked").each(function(){values.push($(this).val())}),values},setValue:function(values){_.isArray(values)||(values=[values]),this.$("input[type=checkbox]").val(values)},focus:function(){this.hasFocus||this.$("input[type=checkbox]").first().focus()},blur:function(){this.hasFocus&&this.$("input[type=checkbox]:focus").blur()},_arrayToHtml:function(array){var html=[],self=this;return _.each(array,function(option,index){var itemHtml="<li>",close=!0;if(_.isObject(option))if(option.group){var originalId=self.id;self.id+="-"+self.groupNumber++,itemHtml='<fieldset class="group"> <legend>'+option.group+"</legend>",itemHtml+=self._arrayToHtml(option.options),itemHtml+="</fieldset>",self.id=originalId,close=!1}else{var val=option.val||0===option.val?option.val:"";itemHtml+='<input type="checkbox" name="'+self.getName()+'" value="'+val+'" id="'+self.id+"-"+index+'" />',itemHtml+='<label for="'+self.id+"-"+index+'">'+option.label+"</label>"}else itemHtml+='<input type="checkbox" name="'+self.getName()+'" value="'+option+'" id="'+self.id+"-"+index+'" />',itemHtml+='<label for="'+self.id+"-"+index+'">'+option+"</label>";close&&(itemHtml+="</li>"),html.push(itemHtml)}),html.join("")}}),Form.editors.Object=Form.editors.Base.extend({hasNestedForm:!0,initialize:function(options){if(this.value={},Form.editors.Base.prototype.initialize.call(this,options),!this.form)throw new Error('Missing required option "form"');if(!this.schema.subSchema)throw new Error("Missing required 'schema.subSchema' option for Object editor")},render:function(){var NestedForm=this.form.constructor;return this.nestedForm=new NestedForm({schema:this.schema.subSchema,data:this.value,idPrefix:this.id+"_",Field:NestedForm.NestedField}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return this.nestedForm?this.nestedForm.getValue():this.value},setValue:function(value){this.value=value,this.render()},focus:function(){this.hasFocus||this.nestedForm.focus()},blur:function(){this.hasFocus&&this.nestedForm.blur()},remove:function(){this.nestedForm.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){return this.nestedForm.validate()},_observeFormEvents:function(){this.nestedForm&&this.nestedForm.on("all",function(){var args=_.toArray(arguments);args[1]=this,this.trigger.apply(this,args)},this)}}),Form.editors.NestedModel=Form.editors.Object.extend({initialize:function(options){if(Form.editors.Base.prototype.initialize.call(this,options),!this.form)throw new Error('Missing required option "form"');if(!options.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var NestedForm=this.form.constructor,data=this.value||{},nestedModel=(this.key,this.schema.model),modelInstance=data.constructor===nestedModel?data:new nestedModel(data);return this.nestedForm=new NestedForm({model:modelInstance,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){var error=this.nestedForm.commit();return error?(this.$el.addClass("error"),error):Form.editors.Object.prototype.commit.call(this)}}),Form.editors.Date=Form.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){if(this.hasFocus){var self=this;setTimeout(function(){self.$("select:focus")[0]||self.trigger("blur",self)},0)}}},initialize:function(options){options=options||{},Form.editors.Base.prototype.initialize.call(this,options);var Self=Form.editors.Date,today=new Date;if(this.options=_.extend({monthNames:Self.monthNames,showMonthNames:Self.showMonthNames},options),this.schema=_.extend({yearStart:today.getFullYear()-100,yearEnd:today.getFullYear()},options.schema||{}),this.value&&!_.isDate(this.value)&&(this.value=new Date(this.value)),!this.value){var date=new Date;date.setSeconds(0),date.setMilliseconds(0),this.value=date}this.template=options.template||this.constructor.template},render:function(){var options=this.options,schema=this.schema,datesOptions=_.map(_.range(1,32),function(date){return'<option value="'+date+'">'+date+"</option>"}),monthsOptions=_.map(_.range(0,12),function(month){var value=options.showMonthNames?options.monthNames[month]:month+1;return'<option value="'+month+'">'+value+"</option>"}),yearRange=schema.yearStart<schema.yearEnd?_.range(schema.yearStart,schema.yearEnd+1):_.range(schema.yearStart,schema.yearEnd-1,-1),yearsOptions=_.map(yearRange,function(year){return'<option value="'+year+'">'+year+"</option>"}),$el=$($.trim(this.template({dates:datesOptions.join(""),months:monthsOptions.join(""),years:yearsOptions.join("")})));return this.$date=$el.find('[data-type="date"]'),this.$month=$el.find('[data-type="month"]'),this.$year=$el.find('[data-type="year"]'),this.$hidden=$('<input type="hidden" name="'+this.key+'" />'),$el.append(this.$hidden),this.setValue(this.value),this.setElement($el),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var year=this.$year.val(),month=this.$month.val(),date=this.$date.val();return year&&month&&date?new Date(year,month,date):null},setValue:function(date){this.$date.val(date.getDate()),this.$month.val(date.getMonth()),this.$year.val(date.getFullYear()),this.updateHidden()},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var val=this.getValue();_.isDate(val)&&(val=val.toISOString()),this.$hidden.val(val)}},{template:_.template('    <div>      <select data-type="date"><%= dates %></select>      <select data-type="month"><%= months %></select>      <select data-type="year"><%= years %></select>    </div>  ',null,Form.templateSettings),showMonthNames:!0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]}),Form.editors.DateTime=Form.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){if(this.hasFocus){var self=this;setTimeout(function(){self.$("select:focus")[0]||self.trigger("blur",self)},0)}}},initialize:function(options){options=options||{},Form.editors.Base.prototype.initialize.call(this,options),this.options=_.extend({DateEditor:Form.editors.DateTime.DateEditor},options),this.schema=_.extend({minsInterval:15},options.schema||{}),this.dateEditor=new this.options.DateEditor(options),this.value=this.dateEditor.value,this.template=options.template||this.constructor.template},render:function(){function pad(n){return 10>n?"0"+n:n}var schema=this.schema,hoursOptions=_.map(_.range(0,24),function(hour){return'<option value="'+hour+'">'+pad(hour)+"</option>"}),minsOptions=_.map(_.range(0,60,schema.minsInterval),function(min){return'<option value="'+min+'">'+pad(min)+"</option>"}),$el=$($.trim(this.template({hours:hoursOptions.join(),mins:minsOptions.join()})));return $el.find("[data-date]").append(this.dateEditor.render().el),this.$hour=$el.find('select[data-type="hour"]'),this.$min=$el.find('select[data-type="min"]'),this.$hidden=$el.find('input[type="hidden"]'),this.setValue(this.value),this.setElement($el),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var date=this.dateEditor.getValue(),hour=this.$hour.val(),min=this.$min.val();return date&&hour&&min?(date.setHours(hour),date.setMinutes(min),date):null},setValue:function(date){_.isDate(date)||(date=new Date(date)),this.dateEditor.setValue(date),this.$hour.val(date.getHours()),this.$min.val(date.getMinutes()),this.updateHidden()},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var val=this.getValue();_.isDate(val)&&(val=val.toISOString()),this.$hidden.val(val)},remove:function(){this.dateEditor.remove(),Form.editors.Base.prototype.remove.call(this)}},{template:_.template('    <div class="bbf-datetime">      <div class="bbf-date-container" data-date></div>      <select data-type="hour"><%= hours %></select>      :      <select data-type="min"><%= mins %></select>    </div>  ',null,Form.templateSettings),DateEditor:Form.editors.Date}),Form.VERSION="0.13.0",Backbone.Form=Form,"undefined"!=typeof exports&&(exports=Form)}(window||global||this);var Location=Backbone.Model.extend({idAttribute:"_id",toString:function(){return this.get("name")}}),Request=Backbone.Model.extend({schema:{type:{type:"Select",options:function(callback){var types=new Types;types.fetch({success:function(){callback(types)}})}},location:{type:"Select",options:function(callback){var locations=new Locations;locations.fetch({success:function(){callback(locations)}})},validators:["required"]},description:{validators:["required"]},urgent:{type:"Radio",options:{"false":"No","true":"Yes"}},created:{type:"Hidden"}},idAttribute:"_id",url:"/request",defaults:{user:{name:null},created:new Date},initialize:function(){this.on("change",function(){this.save()},this)}}),Role=Backbone.Model.extend({toString:function(){return this.get("name")}}),Type=Backbone.Model.extend({idAttribute:"_id",toString:function(){return this.get("name")}}),User=Backbone.Model.extend({schema:{username:{validators:["required"]}},urlRoot:"user",idAttribute:"_id",synced:!1,initialize:function(){var self=this;this.fetch({success:function(model){self.set(model.attributes),self.synced=!0},error:function(){self.synced=!0,asapp.redirect("#login")}})},isSynced:function(){return this.synced},login:function(callback){var self=this;this.save(null,{success:function(model){model.id?(self.set(model.attributes),callback()):callback("login failed")},error:function(){console.error("login error")}})}}),Locations=Backbone.Collection.extend({model:Location,url:"/locations",initialize:function(){this.fetch()}}),Requests=Backbone.Collection.extend({model:Request,url:"/requests",el:"#monitor tbody",initialize:function(){this.$el=$(this.el),this.on({add:function(model){var view=new MonitorView({model:model});this.$el.append(view.render().el)}},this)}}),Roles=Backbone.Collection.extend({model:Role,initialize:function(){this.add([{id:1,name:"Room Manager"},{id:2,name:"AV"}])}}),Types=Backbone.Collection.extend({model:Type,url:"/types"}),LoginView=Backbone.View.extend({el:"#login",render:function(){var form=new Backbone.Form({model:asapp.user}).render();return form.$el.append('<input type="submit" value="Login">'),this.$el.find(".bbform").html(form.el),form.$el.submit(function(event){event.preventDefault();var err=form.commit({validate:!0});err?console.error(err):asapp.user.login(function(err){return err?void console.error(err):void asapp.redirect("#request")})}),this}}),MonitorView=Backbone.View.extend({tagName:"tr",template:_.template("<td><%- new Date(created).toLocaleDateString() %> <%- new Date(created).toLocaleTimeString() %></td><td><%- location.name %></td><td><%- user.username %></td><td><%- type.name %></td><td><%- description %></td><td><%- status.name %></td>"),initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),ProfileView=Backbone.View.extend({el:"#form-profile",render:function(){var form=new Backbone.Form({model:asapp.user}).render();return form.$el.append('<input type="submit" value="Save">'),this.$el.html(form.el),form.$el.submit(function(event){event.preventDefault();var err=form.commit({validate:!0});err||console.log(asapp.user.attributes)}),this}}),RequestView=Backbone.View.extend({el:"#request",events:{submit:"submit"},render:function(){return this.form=new Backbone.Form({model:this.model}).render(),this.form.$el.append('<input type="submit" value="Save">'),this.$el.find(".bbform").html(this.form.el),this},submit:function(event){event.preventDefault();var err=this.form.commit({validate:!0});err||this.collection.add(this.model)}});jQuery(document).on("mobileinit",function(){console.log("JQM ready"),$.extend($.mobile,{defaultPageTransition:"none"}),$.mobile.page.prototype.options.theme="b",$(document).on("pagecontainerbeforeshow",function(event){asapp.user.isSynced()&&!asapp.user.id&&"login"!==getCurrentPage()&&(event.preventDefault(),asapp.redirect("#login"))}),$(document).on("pagecontainershow",function(){asapp.router.navigate(getCurrentPage(),{trigger:!0})})});var asapp={redirect:function(page){$(":mobile-pagecontainer").pagecontainer("change",page)}};jQuery(function($){console.log("DOM ready"),Backbone.$=$,asapp.user=new User,asapp.requests=new Requests,asapp.router=new Router,Backbone.history.start({pushState:!1});var pusher=new Pusher("89dd0fd43699d54bb1bf"),channel=pusher.subscribe("requests");channel.bind("add",function(data){console.log(data),asapp.requests.fetch()})});var Router=Backbone.Router.extend({routes:{login:"login",request:"request",monitor:"monitor",settings:"settings"},initialize:function(){this.bind("all",function(){$(":mobile-pagecontainer").pagecontainer("getActivePage").trigger("create")})},login:function(){(new LoginView).render()},request:function(){var view=new RequestView({collection:asapp.requests,model:new asapp.requests.model});view.render()},monitor:function(){asapp.requests.fetch()},settings:function(){var view=new ProfileView;view.render()}});